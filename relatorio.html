<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Relat√≥rio de Campo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@600;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0078ff;
  --accent:#00b4ff;
  --bg:#f5f8fb;
  --card:#ffffff;
  --text:#1a1a1a;
  --muted:#666;
  --border:#e3e6eb;
  --shadow:0 8px 28px rgba(0,0,0,0.08);
}
.dark{
  --bg:#0f1419;
  --card:#1b2228;
  --text:#e8eef5;
  --muted:#a7b0bc;
  --border:#2b3139;
  --shadow:0 6px 22px rgba(0,0,0,0.6);
}
*{
  box-sizing:border-box;
  font-family:"Inter",sans-serif;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
  background:var(--card);
  border-bottom:1px solid var(--border);
  box-shadow:var(--shadow);
  position:sticky;
  top:0;
  z-index:10;
}
header h1{
  margin:0;
  font-family:"Outfit";
  font-weight:800;
  font-size:1.2rem;
  color:var(--primary);
}
#themeToggle{
  width:38px;
  height:38px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  cursor:pointer;
  font-size:1.1rem;
}
main{
  flex:1;
  max-width:920px;
  margin:20px auto;
  padding:16px;
}
.card{
  background:var(--card);
  border-radius:12px;
  padding:16px;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}
h2{
  margin:0 0 10px;
  font-family:"Outfit";
  font-weight:800;
  color:var(--primary);
}
label{
  display:block;
  margin-top:10px;
  font-weight:600;
  font-size:.85rem;
}
input,select,textarea{
  width:100%;
  padding:9px 10px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  font-size:.9rem;
}
textarea{
  resize:vertical;
  min-height:70px;
}
.grid-2{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:10px;
}
.section-title{
  margin:18px 0 8px;
  font-weight:700;
  color:var(--primary);
}
.horario-row{
  display:flex;
  gap:8px;
  margin-top:8px;
}
.horario-row input{flex:1;}
.btn{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
  border:none;
  padding:10px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
.btn-sec{
  background:#ddd;
  color:#222;
}
#imagePreview{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.thumb-img{
  width:120px;
  height:80px;
  object-fit:cover;
  border-radius:8px;
}
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  padding:8px 14px;
  border-radius:999px;
  background:#111827;
  color:#fff;
  display:none;
  font-size:.8rem;
}
.toast.show{display:block;}
</style>
</head>

<body>

<header>
  <h1>Relat√≥rio de Campo</h1>
  <button id="themeToggle">üåô</button>
</header>

<main>
<div class="card">
<h2>Preencher Relat√≥rio</h2>

<div class="section-title">Dados principais</div>
<div class="grid-2">
  <div>
    <label>N√∫mero da PT</label>
    <input id="numeroPt">
  </div>
  <div>
    <label>Data</label>
    <input id="data" type="date">
  </div>
  <div>
    <label>Equipamento</label>
    <select id="equipamento">
      <option value="">Selecione</option>
      <option>Hidrojato</option>
      <option>Hidrov√°cuo</option>
    </select>
  </div>
  <div>
    <label>Placa</label>
    <input id="placa">
  </div>
</div>

<div class="grid-2">
  <div>
    <label>Local</label>
    <input id="local">
  </div>
  <div>
    <label>TAG</label>
    <input id="tag">
  </div>
  <div>
    <label>Solicitante</label>
    <input id="solicitante">
  </div>
  <div>
    <label>Operador</label>
    <input id="operador">
  </div>
</div>

<div class="section-title">Hor√°rios</div>
<div class="horario-row">
  <input id="h_inicio" placeholder="In√≠cio (HH:MM)">
  <input id="h_fim" placeholder="Fim (HH:MM)">
</div>

<div class="section-title">Observa√ß√µes</div>
<textarea id="observacoes"></textarea>

<div style="margin-top:16px;display:flex;gap:10px;">
  <button id="btnSalvar" class="btn">Salvar relat√≥rio</button>
  <button id="btnLimpar" class="btn btn-sec">Limpar</button>
</div>
</div>
</main>

<div id="toast" class="toast"></div>

<!-- FIREBASE (IGUAL AO ADMIN) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBIihMuDH951zhIqey5pcCY5hFRQv-jm2I",
  authDomain: "hidrojato-rss3-3f04a.firebaseapp.com",
  projectId: "hidrojato-rss3-3f04a",
  storageBucket: "hidrojato-rss3-3f04a.firebasestorage.app",
  messagingSenderId: "607637004872",
  appId: "1:607637004872:web:ffe7b32d1e92d80d4c2e7d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
<script>
/* ===== TEMA ===== */
const themeToggle = document.getElementById("themeToggle");
if(localStorage.getItem("tema")==="dark"){
  document.body.classList.add("dark");
  themeToggle.textContent="‚òÄÔ∏è";
}
themeToggle.onclick = ()=>{
  document.body.classList.toggle("dark");
  const dark = document.body.classList.contains("dark");
  themeToggle.textContent = dark ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("tema", dark ? "dark" : "light");
};

/* ===== TOAST ===== */
const toast = document.getElementById("toast");
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

/* ===== BOT√ïES ===== */
const btnSalvar = document.getElementById("btnSalvar");
const btnLimpar = document.getElementById("btnLimpar");

/* ===== LIMPAR ===== */
btnLimpar.onclick = ()=>{
  if(!confirm("Deseja limpar todos os campos?")) return;
  document.querySelectorAll("input, textarea, select").forEach(el=>{
    if(el.type==="date") return;
    el.value="";
  });
};

/* ===== SALVAR RELAT√ìRIO ===== */
btnSalvar.onclick = async ()=>{
  const dados = {
    numeroPT: document.getElementById("numeroPt").value.trim(),
    data: document.getElementById("data").value,
    equipamento: document.getElementById("equipamento").value,
    placa: document.getElementById("placa").value.trim(),
    local: document.getElementById("local").value.trim(),
    tag: document.getElementById("tag").value.trim(),
    solicitante: document.getElementById("solicitante").value.trim(),
    operador: document.getElementById("operador").value.trim(),
    horarios:{
      inicio: document.getElementById("h_inicio").value.trim(),
      fim: document.getElementById("h_fim").value.trim()
    },
    observacoes: document.getElementById("observacoes").value.trim(),
    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
  };

  // valida√ß√µes m√≠nimas
  if(
    !dados.numeroPT ||
    !dados.data ||
    !dados.equipamento ||
    !dados.placa ||
    !dados.local ||
    !dados.operador
  ){
    alert("Preencha todos os campos obrigat√≥rios.");
    return;
  }

  if(!navigator.onLine){
    alert("Sem internet. Verifique a conex√£o.");
    return;
  }

  try{
    btnSalvar.disabled = true;
    btnSalvar.textContent = "Salvando...";

    await db.collection("relatoriosCampo").add(dados);

    showToast("Relat√≥rio salvo com sucesso!");
    setTimeout(()=>{
      window.location.href = "index.html";
    },1200);

  }catch(err){
    console.error(err);
    alert("Erro ao salvar relat√≥rio. Verifique o Firebase.");
  }finally{
    btnSalvar.disabled = false;
    btnSalvar.textContent = "Salvar relat√≥rio";
  }
};
</script>

</body>
</html>
