<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Relat√≥rio de Campo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@600;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0078ff;
  --accent:#00b4ff;
  --bg:#f5f8fb;
  --card:#ffffff;
  --text:#1a1a1a;
  --muted:#666;
  --border:#e3e6eb;
  --shadow:0 8px 28px rgba(0,0,0,0.08);
}
.dark{
  --bg:#0f1419;
  --card:#1b2228;
  --text:#e8eef5;
  --muted:#a7b0bc;
  --border:#2b3139;
  --shadow:0 6px 22px rgba(0,0,0,0.6);
}
*{box-sizing:border-box;font-family:"Inter",sans-serif;}
body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border);box-shadow:var(--shadow);}
header h1{margin:0;font-family:"Outfit";font-weight:800;font-size:1.2rem;color:var(--primary);}
#themeToggle{width:38px;height:38px;border-radius:10px;border:1px solid var(--border);background:transparent;cursor:pointer;}
main{flex:1;max-width:920px;margin:20px auto;padding:16px;}
.card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border);box-shadow:var(--shadow);}
.section-title{margin:18px 0 8px;font-weight:700;color:var(--primary);}
label{display:block;margin-top:10px;font-weight:600;font-size:.85rem;}
input,select,textarea{width:100%;padding:9px;border-radius:8px;border:1px solid var(--border);}
textarea{min-height:70px;}
.grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;}
.horario-row{display:flex;gap:8px;margin-top:8px;}
.horario-row input{flex:1;}
.btn{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none;padding:11px;border-radius:10px;font-weight:700;cursor:pointer;}
.btn-sec{background:#ddd;color:#222;}
footer{text-align:center;padding:12px;font-size:.8rem;color:var(--muted);}
.time-input{font-family:inherit;}
</style>
</head>

<body>

<header>
  <h1>Relat√≥rio de Campo</h1>
  <button id="themeToggle">üåô</button>
</header>

<main>
<div class="card">

<div class="section-title">Dados principais</div>
<div class="grid-2">
  <div>
    <label>N√∫mero da PT</label>
    <input id="numeroPt">
  </div>
  <div>
    <label>Data</label>
    <input id="data" type="date">
  </div>
  <div>
    <label>Equipamento</label>
    <select id="equipamento">
      <option value="">Selecione</option>
      <option>Hidrojato</option>
      <option>Hidrov√°cuo</option>
    </select>
  </div>
  <div>
    <label>Placa</label>
    <input id="placa">
  </div>
</div>

<div class="grid-2">
  <div>
    <label>Local</label>
    <input id="local">
  </div>
  <div>
    <label>TAG</label>
    <input id="tag">
  </div>
  <div>
    <label>Solicitante</label>
    <input id="solicitante">
  </div>
  <div>
    <label>Operador</label>
    <input id="operador">
  </div>
</div>

<div class="section-title">Hor√°rios</div>

<div class="horario-row">
  <input id="h_inicio" class="time-input" placeholder="__:__">
  <button class="btn" data-h="h_inicio">Marcar</button>
</div>

<div class="horario-row">
  <input id="h_fim" class="time-input" placeholder="__:__">
  <button class="btn" data-h="h_fim">Marcar</button>
</div>

<div class="section-title">Atividade</div>
<div class="grid-2">
  <div>
    <label>Tipo</label>
    <select id="tipoAtividade">
      <option value="">Selecione</option>
      <option>Suc√ß√£o</option>
      <option>Descarte</option>
    </select>
  </div>
  <div>
    <label>√ìleo</label>
    <select id="oleo">
      <option value="">Selecione</option>
      <option>Sim</option>
      <option>N√£o</option>
    </select>
  </div>
</div>

<label>Observa√ß√µes</label>
<textarea id="observacoes"></textarea>

<div style="margin-top:16px;display:flex;gap:10px;">
  <button id="btnSalvar" class="btn">Salvar relat√≥rio</button>
  <button id="btnLimpar" class="btn btn-sec">Limpar</button>
</div>

</div>
</main>

<footer>¬© 2025 | Relat√≥rios de Campo ‚Äî RSS3</footer>

<!-- FIREBASE (IGUAL AO ADMIN) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBIihMuDH951zhIqey5pcCY5hFRQv-jm2I",
  authDomain: "hidrojato-rss3-3f04a.firebaseapp.com",
  projectId: "hidrojato-rss3-3f04a",
  storageBucket: "hidrojato-rss3-3f04a.firebasestorage.app",
  messagingSenderId: "607637004872",
  appId: "1:607637004872:web:ffe7b32d1e92d80d4c2e7d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
<script>
/* ===== TEMA ===== */
const themeToggle=document.getElementById("themeToggle");
if(localStorage.getItem("tema")==="dark"){
  document.body.classList.add("dark");
  themeToggle.textContent="‚òÄÔ∏è";
}
themeToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  const dark=document.body.classList.contains("dark");
  themeToggle.textContent=dark?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("tema",dark?"dark":"light");
};

/* ===== MARCAR HOR√ÅRIO ===== */
function horaAgora(){
  const d=new Date();
  return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
}
document.querySelectorAll("[data-h]").forEach(btn=>{
  btn.onclick=()=>{
    document.getElementById(btn.dataset.h).value=horaAgora();
  };
});

/* ===== M√ÅSCARA DE HORA ===== */
document.querySelectorAll(".time-input").forEach(el=>{
  el.addEventListener("input",()=>{
    let v=el.value.replace(/\D/g,"").slice(0,4);
    if(v.length<=2) el.value=v;
    else el.value=v.slice(0,2)+":"+v.slice(2);
  });
});

/* ===== VALIDAR HORA ===== */
function horaValida(v){
  if(!v || !v.includes(":")) return false;
  const [h,m]=v.split(":").map(Number);
  return h>=0&&h<=23&&m>=0&&m<=59;
}

/* ===== SALVAR RELAT√ìRIO ===== */
document.getElementById("btnSalvar").onclick=async()=>{
  const payload={
    numeroPT:document.getElementById("numeroPt").value.trim(),
    data:document.getElementById("data").value,
    equipamento:document.getElementById("equipamento").value,
    placa:document.getElementById("placa").value.trim(),
    local:document.getElementById("local").value.trim(),
    tag:document.getElementById("tag").value.trim(),
    solicitante:document.getElementById("solicitante").value.trim(),
    operador:document.getElementById("operador").value.trim(),
    horarios:{
      inicio:document.getElementById("h_inicio").value.trim(),
      fim:document.getElementById("h_fim").value.trim()
    },
    especificacoes:{
      tipoAtividade:document.getElementById("tipoAtividade").value,
      oleo:document.getElementById("oleo").value
    },
    observacoes:document.getElementById("observacoes").value.trim(),
    criadoEm:firebase.firestore.FieldValue.serverTimestamp()
  };

  if(!payload.numeroPT||!payload.data||!payload.equipamento||!payload.placa){
    alert("Preencha todos os campos obrigat√≥rios.");
    return;
  }
  if(payload.horarios.inicio && !horaValida(payload.horarios.inicio)){
    alert("Hora in√≠cio inv√°lida.");
    return;
  }
  if(payload.horarios.fim && !horaValida(payload.horarios.fim)){
    alert("Hora fim inv√°lida.");
    return;
  }

  try{
    await db.collection("relatoriosCampo").add(payload);
    alert("Relat√≥rio salvo com sucesso.");
    window.location.reload();
  }catch(e){
    console.error(e);
    alert("Erro ao salvar relat√≥rio.");
  }
};

/* ===== LIMPAR ===== */
document.getElementById("btnLimpar").onclick=()=>{
  if(!confirm("Limpar tudo?")) return;
  document.querySelectorAll("input,textarea,select").forEach(el=>el.value="");
};
</script>

</body>
</html>
